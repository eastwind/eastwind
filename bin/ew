#!/usr/bin/env python
#-*- coding:utf-8 -*-

import sys
from os.path import dirname, abspath, realpath

program = sys.argv[0]
LANUCH_DIR = dirname(abspath(sys.path[0]))

# If launched from source directory
if program.startswith('./') or program.startswith('bin/'):
    sys.path.insert(0, LANUCH_DIR)

import eastwind.utils as utils
from eastwind.package import EastwindPackage
from eastwind.manager import EastwindPkgManager, EastwindRecordManager

class Eastwind:
    """ Command line interface for eastwin """

    def __init__(self):
        if len(sys.argv) == 1:
            print >> sys.stderr, 'Usage:', sys.argv[0], '[ACTIONS]'
            sys.exit(1)
        self.handle(sys.argv[1], sys.argv[2:])

    def handle(self, action, arg):
        if action == 'pack':
            pkg = EastwindPackage(arg[0])
            pkg.pack(arg[1])
        elif action == 'unpack':
            pkg = EastwindPackage.extract(arg[0])
            pkg.unpack()
        elif action == 'record':
            if arg[0] == 'start':
                EastwindRecordManager().start(arg[1])
            elif arg[0] == 'stop':
                EastwindRecordManager().stop()
            elif arg[0] == 'change':
                EastwindRecordManager().change(arg[1])
            else:
                print >> sys.stderr, 'Record action [%s] is unknown' % arg[0]
        elif action == 'install':
            EastwindPkgManager().install(arg)
            EastwindRecordManager().add({action: ' '.join(arg)})
        elif action == 'remove':
            EastwindPkgManager().remove(arg)
            EastwindRecordManager().add({action: ' '.join(arg)})
        elif action == 'update':
            EastwindPkgManager().update()
            EastwindRecordManager().add({action: ''})
        elif action == 'upgrade':
            EastwindPkgManager().upgrade()
            EastwindRecordManager().add({action: ''})
        else:
            print >> sys.stderr, 'Action [%s] is unknown' % action

if __name__ == "__main__":
    Eastwind()

